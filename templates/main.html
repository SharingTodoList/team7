{% extends 'basic.html' %}
{% block content %}
    <script>

        function time2str(date) {
        let month = date.getMonth() + 1;
        let day = date.getDate();

        month = month >= 10 ? month : '0' + month;
        day = day >= 10 ? day : '0' + day;

        return date.getFullYear() + '/' + month + '/' + day
        }

        function num2str(count) {
            if (count > 10000) {
                return parseInt(count / 1000) + "k"
            }
            if (count > 500) {
                return parseInt(count / 100) / 10 + "k"
            }
            if (count == 0) {
                return ""
            }
            return count
        }

        function get_posts() {
            let schDate = $('#schDate').val();

            $("#post-box").empty()
            $.ajax({
                type: "POST",
                url: "/get_posts",
                data: {
                            date_give: schDate
                        },
                success: function (response) {
                    if (response["result"] == "success") {
                        let posts = response["posts"]
                        for (let i = 0; i < posts.length; i++) {
                            let post = posts[i]
                            let time_post = new Date(post["date"])
                            let time_before = time2str(time_post)
                            let status      = post['status']
                            if(status == 1){
                                    status = '‚≠ï'
                                }else{
                                    status = '‚ùå'
                                }
                            let html_temp = `<div class="box" id="${post["_id"]}">
                                                <article class="media">
                                                    <div class="media-content">
                                                        <div class="content">
                                                            <p>
                                                                <strong>${post['id']}</strong>
                                                                <br>
                                                                ${time_before}
                                                                <br>
                                                                ${post['time']}
                                                                <br>
                                                                ${post['detail']}
                                                                <br>
                                                                ${status}
                                                            </p>
                                                        </div>

                                                    </div>
                                                </article>
                                            </div>`
                            $("#post-box").append(html_temp)
                        }
                    }
                }
            })
        }

        $(document).ready(function () {
            let today = new Date();
            let year = today.getFullYear(); // ÎÖÑÎèÑ
            let month = today.getMonth() + 1;  // Ïõî
            let date = today.getDate();  // ÎÇ†Ïßú
            let day = today.getDay();  // ÏöîÏùº

            if (month < 10) {
                month = "0" + month
            }

            $('#schDate').val(year + '-' + month + '-' + date)
            get_posts();
        })

        function schDate(){
            if (window.event.keyCode == 13) {
                get_posts();
            }
        }
    </script>
<body>
<div class ="schBar menu subtitle is-sparta" >
üìÜ<input type="date" id ="schDate" onkeyup="schDate()">Ïùò to-do
<label>(ÎÇ†Ïßú ÏûÖÎ†• ÌõÑ ÏóîÌÑ∞Î•º ÎàåÎü¨Ï£ºÏÑ∏Ïöî‚Üµ)</label>
</div>
<section class="section">
    <div id="post-box" class="container">
    </div>
</section>
</body>
{% endblock %}